pipeline {
  agent any
  options {
    ansiColor('xterm')  // Plugin AnsiColor
  }
  stages {
    stage ('clone git repo') {
      steps {
        //git 'https://github.com/OMironyuk/DevSchool.git'
        sh 'pwd'
      }
    }
    stage('TF Init&Plan') {
      steps {
          dir('Certification_work') {
           sh 'terraform init'
           sh 'terraform plan'
           sh 'terraform apply -auto-approve'
          }
        }
      }
    stage ('Provisioning build by ansible') {
      steps {
        dir('Certification_work') {
          withAWS(credentials: 'AWS-creds', region: 'eu-central-1') {   //plugin Pipeline: AWS Steps
            ansiblePlaybook colorized: true, credentialsId: 'jenkins-key', installation: 'Ansible', playbook: 'playbook.yml', disableHostKeyChecking: true, sudoUser: null  //plugin Ansible
          }
        }
      }
    }
  }
}